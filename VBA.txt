Sub Main()    'clearDebugConsole    reinitializer        For i = 1 To 7        setGuard (i)        setVigil (i)    Next i    'For i = 1 To 7    '    setVigil (i)            'Next i  End SubFunction clearDebugConsole()    For i = 0 To 100        Debug.Print ""    Next iEnd Function' 오픈소스배열섞기Function ShuffleArray(InArray)Dim N As Long    Dim Temp As Variant    Dim J As Long    Dim Arr() As VariantRandomize    L = UBound(InArray) - LBound(InArray) + 1    ReDim Arr(LBound(InArray) To UBound(InArray))    For N = LBound(InArray) To UBound(InArray)        Arr(N) = InArray(N)    Next N    For N = LBound(InArray) To UBound(InArray)        J = CLng(((UBound(InArray) - N) * Rnd) + N)        Temp = Arr(N)        Arr(N) = Arr(J)        Arr(J) = Temp    Next N    ShuffleArray = ArrEnd Function' 바꾸기 전으로 초기화Function reinitializer()    For J = 4 To 12        For i = 2 To 51                If (Cells(i, J) <> "휴가" And Cells(i, J) <> "당직" And Cells(i, J) <> "외박" And Cells(i, J) <> "외출" And Cells(i, J) <> "VTC" And Cells(i, J) <> "AMP" And Cells(i, J) <> "새벽근무") Then                    Cells(i, J).Value = ""                End If        Next i    Next J    End Function' 초병 넣기Function setGuard(day As Integer)    guard_count_senior = 1 ' to 5    guard_count_junior = 1 ' to 5            nonNightWorker = ShuffleArray(getNonNightWorker)    nonNightWorker_len = ArrayLen(nonNightWorker)        For nonNightWorker_index = 0 To nonNightWorker_len - 1 ' 문취,운전병,행정병은 야간근무가 없으니 초병 우선으로 투입        Dim real_index As Integer        real_index = nonNightWorker(nonNightWorker_index)        If (Cells(real_index, day + 3) = "") Then ' 빈칸이어야 함            If (getNightWorkCount(real_index) < 3) Then '3회 미만 근무여야함.                If (didWorkLastNight(real_index, day) = False) Then  '전날 야간근무가 없어야함                    If (Cells(real_index, 3) = "사수" And guard_count_senior < 6) Then ' 사수면 초병사수에 들어감                        Cells(real_index, day + 3) = "초병" & guard_count_senior & "/사수"                        guard_count_senior = guard_count_senior + 1                    ElseIf (Cells(real_index, 3) = "부사수" And guard_count_junior < 6) Then ' 부사수면 초병부사수에 들어감                        Cells(real_index, day + 3) = "초병" & guard_count_junior & "/부사수"                        guard_count_junior = guard_count_junior + 1                    End If                End If            End If        End If    Next nonNightWorker_index        Do While (guard_count_senior < 6 Or guard_count_junior < 6)        For real_index = 1 To 51 '야간근무 하는 자들 포함해서 수행            If (Cells(real_index, day + 3) = "") Then ' 빈칸이어야 함                If (getNightWorkCount(real_index) < 3) Then '3회 미만 근무여야함.                    If (didWorkLastNight(real_index, day) = False) Then  '전날 야간근무가 없어야함                        If (Cells(real_index, 3) = "사수" And guard_count_senior < 6) Then ' 사수면 초병사수에 들어감                            Cells(real_index, day + 3) = "초병" & guard_count_senior & "/사수"                            guard_count_senior = guard_count_senior + 1                        ElseIf (Cells(real_index, 3) = "부사수" And guard_count_junior < 6) Then ' 부사수면 초병부사수에 들어감                            Cells(real_index, day + 3) = "초병" & guard_count_junior & "/부사수"                            guard_count_junior = guard_count_junior + 1                        End If                    End If                End If            End If        Next real_index    Loop End Function' 불침번 넣기Function setVigil(day)    vigil_count_senior = 1 ' to 6        ' 불침번은 직무에 상관없이 수행    For vigil_count_senior = 1 To 6        Dim num As Integer        Do While True ' 빈칸 찾을 때까지 반복            num = getRandomNumber                        If (Cells(1 + num, day + 3) = "") Then ' 근무가 없고                If (getNightWorkCount(1 + num) < 3) Then '3회 미만 근무여야                 Exit Do ' 고르기 확정                End If            End If        Loop                Cells(1 + num, day + 3) = "불침번" & vigil_count_senior            Next vigil_count_senior    End FunctionFunction getNightWorkCount(rowIndex As Integer)        nightWorks = Array("휴가", "외박", "외출", "")    Dim Count As Integer    Count = 7    For i = 4 To 11        For J = 0 To 3            If (nightWorks(J) = Cells(rowIndex, i)) Then                Count = Count - 1            End If        Next J    Next i    getNightWorkCount = Count 'Function은 함수이름에 값을넣어 return 한다.    End FunctionFunction getRandomNumber()    Randomize    Dim RandomNumber As Integer    RandomNumber = (49 * Rnd) + 1    getRandomNumber = RandomNumberEnd Function' 전날 밤에 야간근무가 있었는지 확인Function didWorkLastNight(rowIndex, day)    If (day = 1) Then        didWorkLastNight = False '월요일은 전날밤없음    Else        If (Cells(rowIndex, 3 + day - 1) = "VTC" Or Cells(rowIndex, 3 + day - 1) = "AMP" Or Cells(rowIndex, 3 + day - 1) = "야간근무" Or Cells(rowIndex, 3 + day - 1) = "새벽근무") Then            didWorkLastNight = True        Else            didWorkLastNight = False        End If    End IfEnd Function' 원래 직무가 야간근무가 없는 사람들 추출, 문서취급병, 운전병, 행정병 => 초병우선 투입Function getNonNightWorker() As Variant    Dim Arr() As String    Dim cursor As Integer    cursor = 0    For Index = 2 To 51        If (Cells(Index, 2) = "문서취급병" Or Cells(Index, 2) = "운전병" Or Cells(Index, 2) = "행정병") Then            ReDim Preserve Arr(0 To cursor)            Arr(cursor) = Index            cursor = cursor + 1        End If    Next Index    'Debug.Print (cursor)    getNonNightWorker = ArrEnd Function' 어레이 길이 구하는 함수Function ArrayLen(Arr As Variant) As Integer    ArrayLen = UBound(Arr) - LBound(Arr) + 1End Function